@using System.Text.RegularExpressions
@inherits StatiqRazorPage<IEnumerable<IDocument>>
<div>    
    @foreach (IDocument post in Model)
    {
        IDocument topicDocument = OutputPages[$"{Constants.BlogPath}/categories/{post.GetString("Category")}/index.html"].First();
        string excerpt = post.GetString(Keys.Excerpt);
        excerpt = excerpt.RemoveEnd("</p>"); //remove final '</p>'
        var words = excerpt.Split().Take(50); //only interested in first 50 words, so add them to array
        excerpt = string.Join(" ", words); //rejoin the words as single string
        excerpt += $" ... <span class=\"small\"><a class=\"tfx-white-link\" href=\"{Context.GetLink(post)+".html"}\">Read more</a></span></p>"; //add it back with some more goodies
        <article class="post">
            <header>
                <h1 itemprop="headline name">
                    <a class="tfx-white-link" itemprop="url" href="@($"{Context.GetLink(post).Substring(1)}.html")">@post.GetString("Title")</a>
                </h1>
                <h3>
                    <time datetime="@post.GetString("Published")" itemprop="datePublished">@post.GetDateTime("Published").ToString("MMMM dd, yyyy")</time>
                    @if (topicDocument != null)
                    {
                        <a href="@(topicDocument.GetLink())"><span class="tfx-badge-light">@topicDocument.GetTitle()</span></a>
                    }
                </h3>
            </header>
            <div class="tfx-article-text-no-bold" itemprop="articleBody">
                @Html.Raw(excerpt)
            </div>
            <div class="collapse" aria-hidden="true" itemprop="author" itemscope="" itemtype="http://schema.org/Person">
                <meta itemprop="name" content="@post.GetString("Author")">
            </div>
            <meta itemprop="dateModified" content="@post.GetString("Modified")">
        </article>
    }
</div>

<br />
@{
    IDocument older = Document.GetDocument(Keys.Next);
    IDocument newer = Document.GetDocument(Keys.Previous);
    Regex lastNumberReg = new Regex(@"\d");

}
@if (older != null || newer != null)
{
    <div class="d-flex flex-row justify-content-between">
        <div>
            @if (older != null)
            {
                <a class="tfx-btn tfx-btn-teal" href="@(!lastNumberReg.IsMatch(Context.GetLink(older).Last().ToString()) ? Context.GetLink(older) : Context.GetLink(older) + ".html")" role="button">&lt;&lt; Older</a>
            }
        </div>
        <div>
            @if (newer != null)
            {
                <a class="tfx-btn tfx-btn-teal" href="@(!lastNumberReg.IsMatch(Context.GetLink(newer).Last().ToString()) ? Context.GetLink(newer) : Context.GetLink(newer) + ".html")" role="button">Newer >></a>
            }
        </div>
    </div>
}

<br/>
<br/>